<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Phabricator批量编辑</title>
<script src="/static/js/vue.min.js"></script>
</head>
<body>
<div id="app">
	<fabtable v-bind:headers='visibleHeaders' :rows='rows' :table_styles='table_styles'></fabtable>
</div>

<script>
"use strict"
var extend = (base, deriving)=>
{
	var derived = JSON.parse(JSON.stringify(base));
	for (var key in deriving)
	{
		derived[key] = deriving[key];
	}
	return derived;
}

var solid_border = {
	'border-style': 'solid',
	'border-width': '1px',
};
var cell_common_style = extend(solid_border, {
	'padding-left': '15px',
	'padding-right': '15px',
	'vertical-align': 'center',
});

var header_style = extend(cell_common_style, {
	'text-align': 'center',
});

var row_style = extend(cell_common_style, {
});

var table_styles = {
	header: header_style,
	row: row_style,
	table: {'border-collapse': 'collapse'},
	typed_cells: {//不同类型的单元格有不同的样式，优先级最高
	},
	typed_rows: {//不同类型的行有不同的样式，优先级高于row
	},
	typed_columns: {//不同类型的列有不同的样式，优先级高于
	},
};

var authorEnums = [
	{val: 'author1', display: 'author1'},
	{val: 'author2', display: 'author2'},
	{val: 'author3', display: 'author3'},
]

var headerData = [
	{value: '编号', accessor: 'id', editable: 'false'},
	{value: '标题', accessor: 'title', editable: 'true', edit_type: 'text', editor_pattern: 'inplace'},
	{value: '作者', accessor: 'author', editable: 'true', edit_type: 'enum', editor_pattern: 'inplace', onums: authorEnums },
	{value: '优先级', accessor: 'priority', editable: 'true', edit_type: 'enum', editor_pattern: 'inplace'},
	{value: '严重程度', accessor: 'severity', editable: 'true', edit_type: 'enum', editor_pattern: 'inplace'},
	{value: '描述', accessor: 'description', editable: 'true', edit_type: 'text', editor_pattern: 'popup'},
];

var rowData = [{id: '1', title: 'Test Task', author: 'tester', priority: 'Unbreak Now!', severity: 'Not a Bug'}];

var fabtableTemplate = `
<table :style='table_styles.table'>
	<tbody>
		<fabHeaderRow v-bind:headers='headers' :header_style='table_styles.header'/>
		<fabRow v-for='row in rows' :row='row' :columns='headers' :row_style='table_styles.row'/>
	</tbody>
</table>
`;

var fabHeaderRowTemplate = `
<TR>
<TH v-for='header in headers' style='border-style: solid; border-width: 1px'> {{header.value}}</TH>
</TR>
`;

var fabRowTemplate = `
<TR>
	<TD v-for='column in columns' :style='row_style' @click='click'>
		{{row | access(column)}}
	</TD>
</TR>
`;

const fabCell = {
	data: {
		currentView: 'raw',
	},
	comopnents: {
		raw: {
			props: ['raw_data'],
			template: `{{raw_data}}`,
		},
	},
};

const fabHeaderRow = {
	props: ['headers', 'header_style'],
	template: fabHeaderRowTemplate,
};

const fabRow = {
	props: ['columns', 'row', 'row_style'],
	template: fabRowTemplate,
	filters: 
	{
		access: function(row, column)
		{
			var accessor = column.accessor;
			return row[accessor];
		},
	},
	methods: {
		click: function(ev)
		{
		},
	},
};

const fabtable = {
	props: ['headers', 'rows', 'header_style', 'table_styles'],
	template: fabtableTemplate,
	components: {
		fabHeaderRow: fabHeaderRow,
		fabRow: fabRow,
	},
};

new Vue({
  el: '#app',
  components: {
	  fabtable: fabtable,
  },
  data: {
    message: 'Hello Vue.js!',
	visibleHeaders: headerData,
	rows: rowData,
	table_styles: table_styles,
  }
})
</script>
</body>
</html>
